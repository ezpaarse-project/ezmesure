(window["ezreporting_bundle_jsonpfunction"]=window["ezreporting_bundle_jsonpfunction"]||[]).push([[0],{23:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.setHttpClient=setHttpClient;exports.setToasts=setToasts;exports.setCapabilities=setCapabilities;exports.capabilities=exports.toasts=exports.httpClient=exports.ms2Str=exports.defaultTask=exports.convertFrequency=void 0;var _common=__webpack_require__(2);var convertFrequency=function convertFrequency(frequencies,frequency){var freq=frequencies.find((function(_ref){var value=_ref.value;return value===frequency}));return freq?freq.text:"Error"};exports.convertFrequency=convertFrequency;var defaultTask=function defaultTask(dashboardId){return{_id:"",dashboardId:dashboardId||null,exists:true,reporting:{frequency:"1w",emails:[],createdAt:"",print:false},namespace:""}};exports.defaultTask=defaultTask;var ms2Str=function ms2Str(time){var ms=time;var s=Math.floor(ms/1e3);ms%=1e3;var m=Math.floor(s/60);s%=60;var h=Math.floor(m/60);m%=60;if(h){return"".concat(h,"h ").concat(m,"m")}if(m){return"".concat(m,"m ").concat(s,"s")}if(s){return"".concat(s,"s")}return"".concat(ms,"ms")};exports.ms2Str=ms2Str;var httpClient;exports.httpClient=httpClient;function setHttpClient(http){exports.httpClient=httpClient=http}var toasts;exports.toasts=toasts;function setToasts(notifications){exports.toasts=toasts=notifications}var capabilities;exports.capabilities=capabilities;function setCapabilities(capa){exports.capabilities=capabilities=capa[_common.PLUGIN_ID]||{}}},24:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.openFlyOut=openFlyOut;exports.closeFlyOut=closeFlyOut;exports.EzreportingTaskEditFlyout=void 0;var _react=_interopRequireWildcard(__webpack_require__(16));var _eui=__webpack_require__(18);var _lodash=__webpack_require__(28);var _react2=__webpack_require__(17);var _i18n=__webpack_require__(19);var _reporting=__webpack_require__(23);function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap;_getRequireWildcardCache=function _getRequireWildcardCache(){return cache};return cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj}}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj.default=obj;if(cache){cache.set(obj,newObj)}return newObj}function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _createSuper(Derived){return function(){var Super=_getPrototypeOf(Derived),result;if(_isNativeReflectConstruct()){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var openFlyOutHandler;function openFlyOut(dashboard,edit){openFlyOutHandler(dashboard,edit)}var closeFlyOutHandler;function closeFlyOut(){closeFlyOutHandler()}var EzreportingTaskEditFlyout=function(_Component){_inherits(EzreportingTaskEditFlyout,_Component);var _super=_createSuper(EzreportingTaskEditFlyout);function EzreportingTaskEditFlyout(props){var _this;_classCallCheck(this,EzreportingTaskEditFlyout);_this=_super.call(this,props);_defineProperty(_assertThisInitialized(_this),"open",(function(dashboard,edit){var currentTask=JSON.parse(JSON.stringify(dashboard||(0,_reporting.defaultTask)(_this.props.dashboards[0].id)));var currentFrequency=(0,_lodash.get)(currentTask,"reporting.frequency");var frequency=_this.props.frequencies.find((function(f){return f.value===currentFrequency}));var receivers=(0,_lodash.get)(currentTask,"reporting.emails",[]);if(typeof receivers==="string"){receivers=receivers.split(",").map((function(e){return e.trim()}))}if(!frequency&&_this.props.frequencies.length>0){(0,_lodash.set)(currentTask,"reporting.frequency",_this.props.frequencies[0].value)}_this.setState({isFlyoutVisible:true,currentTask:currentTask,edit:edit,receivers:receivers,email:"",mailErrorMessages:[],dashboardErrorMessages:[]})}));_defineProperty(_assertThisInitialized(_this),"close",(function(){_this.setState({isFlyoutVisible:false})}));_defineProperty(_assertThisInitialized(_this),"onChangeSpace",(function(selectedSpaces){var currentTask=_objectSpread({},_this.state.currentTask);if(!selectedSpaces.length){currentTask.namespace="";_this.setState({currentTask:currentTask})}currentTask.namespace=selectedSpaces[0].label;_this.setState({currentTask:currentTask});_this.props.onChangeSpaceHandler(selectedSpaces)}));_defineProperty(_assertThisInitialized(_this),"onChangeDashboard",(function(selectedDashboards){var dashboard=selectedDashboards[0];var currentTask=_objectSpread({},_this.state.currentTask);currentTask.dashboardId=dashboard&&dashboard.value;var dashboardErrorMessages=[];if(!currentTask.dashboardId){dashboardErrorMessages.push(_i18n.i18n.translate("ezReporting.pleaseSelectDashboard",{defaultMessage:"Please select a dashboard"}))}_this.setState({currentTask:currentTask,dashboardErrorMessages:dashboardErrorMessages})}));_defineProperty(_assertThisInitialized(_this),"onChangeFrequency",(function(event){var currentTask=_objectSpread({},_this.state.currentTask);currentTask.reporting.frequency=event.target.value;_this.setState({currentTask:currentTask})}));_defineProperty(_assertThisInitialized(_this),"onChangeEmail",(function(event){_this.setState({email:event.target.value})}));_defineProperty(_assertThisInitialized(_this),"onChangeLayout",(function(event){var currentTask=_objectSpread({},_this.state.currentTask);currentTask.reporting.print=event.target.checked;_this.setState({currentTask:currentTask})}));_defineProperty(_assertThisInitialized(_this),"addReceiver",function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(event){var _this$state,email,receivers,emailsList,wrongEmails,i,body,exists,mailErrorMessages;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();_this$state=_this.state,email=_this$state.email,receivers=_this$state.receivers;emailsList=email.split(",")||[email];wrongEmails=[];i=0;case 5:if(!(i<emailsList.length)){_context.next=20;break}_context.prev=6;body=JSON.stringify({email:emailsList[i]});_context.next=10;return _reporting.httpClient.post("/api/ezreporting/email",{body:body});case 10:exists=receivers.includes(emailsList[i]);if(!exists){receivers.push(emailsList[i])}_context.next=17;break;case 14:_context.prev=14;_context.t0=_context["catch"](6);wrongEmails.push(emailsList[i]);case 17:i+=1;_context.next=5;break;case 20:if(!wrongEmails.length){_this.setState({email:"",mailErrorMessages:[],receivers:receivers})}if(wrongEmails.length){mailErrorMessages=wrongEmails.map((function(emailAddress){return _i18n.i18n.translate("ezReporting.pleaseEnterValidEmail",{values:{EMAIL_ADDRESS:emailAddress},defaultMessage:"Please enter a valid email address ({EMAIL_ADDRESS})"})}));_this.setState({mailErrorMessages:mailErrorMessages,email:wrongEmails.join(",")})}case 22:case"end":return _context.stop()}}}),_callee,null,[[6,14]])})));return function(_x){return _ref.apply(this,arguments)}}());_defineProperty(_assertThisInitialized(_this),"removeReceiver",(function(email){_this.setState({receivers:_this.state.receivers.filter((function(r){return r!==email}))})}));_defineProperty(_assertThisInitialized(_this),"saveOrUpdate",(function(){if(_reporting.capabilities.create){var _this$state2=_this.state,edit=_this$state2.edit,currentTask=_this$state2.currentTask,receivers=_this$state2.receivers;(0,_lodash.set)(currentTask,"reporting.emails",receivers);if(edit){return _this.props.editTaskHandler(currentTask).catch((function(err){return _reporting.toasts.addDanger({title:"Error",text:(0,_lodash.get)(err,"data.error","Error")})}))}return _this.props.saveTaskHandler(currentTask).catch((function(err){return _reporting.toasts.addDanger({title:"Error",text:(0,_lodash.get)(err,"data.error","Error")})}))}}));_this.state={isFlyoutVisible:false,edit:false,currentTask:null,email:"",receivers:[],mailErrorMessages:[],dashboardErrorMessages:[],spaceErrorMessages:[]};openFlyOutHandler=_this.open;closeFlyOutHandler=_this.close;return _this}_createClass(EzreportingTaskEditFlyout,[{key:"render",value:function render(){var _this2=this;var _this$state3=this.state,isFlyoutVisible=_this$state3.isFlyoutVisible,currentTask=_this$state3.currentTask,edit=_this$state3.edit,mailErrorMessages=_this$state3.mailErrorMessages,dashboardErrorMessages=_this$state3.dashboardErrorMessages,spaceErrorMessages=_this$state3.spaceErrorMessages,receivers=_this$state3.receivers;var _this$props=this.props,dashboards=_this$props.dashboards,frequencies=_this$props.frequencies,admin=_this$props.admin,spaces=_this$props.spaces,dashboardsBySpace=_this$props.dashboardsBySpace,currentSpaces=_this$props.currentSpaces;var dashboardList=admin?dashboardsBySpace:dashboards;dashboardList=dashboardList.map((function(dashboard){return{value:dashboard.id,label:dashboard.name}}));var invalidMail=mailErrorMessages.length>0;var invalidDashboard=dashboardErrorMessages.length>0;var invalidSpace=spaceErrorMessages.length>0;var invalidForm=invalidDashboard||receivers.length===0;var saveBtn;if(_reporting.capabilities.create){saveBtn=_react.default.createElement(_eui.EuiFormRow,{fullWidth:true},_react.default.createElement(_eui.EuiButton,{fill:true,iconType:"save",type:"submit",onClick:function onClick(){return _this2.saveOrUpdate()},disabled:invalidForm,fullWidth:true},_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.save",defaultMessage:"Save"})))}if(!isFlyoutVisible){return _react.default.createElement(_react.Fragment,null)}var title;if(edit){title=_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.editingTask",defaultMessage:"Editing a reporting task"})}else{title=_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.creatingTask",defaultMessage:"Creating a reporting task"})}var receiverItems=receivers.map((function(email,index){return _react.default.createElement(_eui.EuiListGroupItem,{key:index,label:email,extraAction:{iconType:"trash",iconSize:"s","aria-label":"remove receiver ".concat(email),onClick:function onClick(){_this2.removeReceiver(email)}}})}));var receiversList;if(receiverItems.length>0){receiversList=_react.default.createElement(_eui.EuiFormRow,{fullWidth:true},_react.default.createElement(_eui.EuiListGroup,{maxWidth:false,bordered:true},receiverItems))}var selectedDashboards=dashboardList.filter((function(d){return d.value===currentTask.dashboardId}));var spaceSelector;if(admin){var spacesList=spaces.map((function(space){return{value:space.id,label:space.name,color:space.color}}));var renderOption=function renderOption(option,searchValue,contentClassName){var color=option.color,label=option.label,value=option.value;return(_react.default.createElement(_eui.EuiHealth,{color:color},_react.default.createElement("span",{className:contentClassName},_react.default.createElement(_eui.EuiHighlight,{search:searchValue},label))))};spaceSelector=_react.default.createElement(_eui.EuiFormRow,{fullWidth:true,label:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.space",defaultMessage:"Space"}),isInvalid:invalidSpace,error:spaceErrorMessages},_react.default.createElement(_eui.EuiComboBox,{fullWidth:true,placeholder:_i18n.i18n.translate("ezReporting.selectSpace",{defaultMessage:"Select a space"}),singleSelection:true,options:spacesList,selectedOptions:currentSpaces,onChange:this.onChangeSpace,renderOption:renderOption,isClearable:true,isInvalid:invalidSpace,"data-test-subj":"spaceSearch"}))}var flyOutContent=_react.default.createElement(_eui.EuiForm,null,spaceSelector,_react.default.createElement(_eui.EuiFormRow,{fullWidth:true,label:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.dashboard",defaultMessage:"Dashboard"}),isInvalid:invalidDashboard,error:dashboardErrorMessages},_react.default.createElement(_eui.EuiComboBox,{fullWidth:true,placeholder:_i18n.i18n.translate("ezReporting.selectDashboard",{defaultMessage:"Select a dashboard"}),singleSelection:{asPlainText:true},options:dashboardList,selectedOptions:selectedDashboards,onChange:this.onChangeDashboard,isClearable:true,isInvalid:invalidDashboard})),_react.default.createElement(_eui.EuiFormRow,{fullWidth:true,label:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.frequency",defaultMessage:"Frequency"})},_react.default.createElement(_eui.EuiSelect,{fullWidth:true,options:frequencies,value:currentTask.reporting.frequency,"aria-label":_i18n.i18n.translate("ezReporting.frequency",{defaultMessage:"Frequency"}),onChange:this.onChangeFrequency})),_react.default.createElement(_eui.EuiSpacer,{size:"m"}),_react.default.createElement("form",{onSubmit:this.addReceiver},_react.default.createElement(_eui.EuiFlexGroup,null,_react.default.createElement(_eui.EuiFlexItem,null,_react.default.createElement(_eui.EuiFormRow,{label:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.receiversEmails",defaultMessage:"Receivers' email addresses"}),fullWidth:true,isInvalid:invalidMail,error:mailErrorMessages},_react.default.createElement(_eui.EuiFieldText,{fullWidth:true,placeholder:"Email",value:this.state.email,onChange:this.onChangeEmail}))),_react.default.createElement(_eui.EuiFlexItem,{grow:false},_react.default.createElement(_eui.EuiFormRow,{hasEmptyLabelSpace:true},_react.default.createElement(_eui.EuiButton,{iconType:"plusInCircle",type:"submit"},_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.add",defaultMessage:"Add"})))))),_react.default.createElement(_eui.EuiSpacer,{size:"m"}),receiversList,_react.default.createElement(_eui.EuiFormRow,{fullWidth:true},_react.default.createElement(_eui.EuiCheckbox,{id:"optimize-checkbox",checked:currentTask.reporting.print,label:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.optimizedForPrinting",defaultMessage:"Optimized for printing"}),onChange:this.onChangeLayout})),saveBtn);return(_react.default.createElement(_eui.EuiFlyout,{onClose:this.close,size:"m","aria-labelledby":"flyoutSmallTitle"},_react.default.createElement(_eui.EuiFlyoutHeader,{hasBorder:true},_react.default.createElement(_eui.EuiTitle,{size:"m"},_react.default.createElement("h2",null,title))),_react.default.createElement(_eui.EuiFlyoutBody,null,flyOutContent)))}}]);return EzreportingTaskEditFlyout}(_react.Component);exports.EzreportingTaskEditFlyout=EzreportingTaskEditFlyout},25:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.openFlyOut=openFlyOut;exports.closeFlyOut=closeFlyOut;exports.EzreportingHistoryFlyout=void 0;var _react=_interopRequireWildcard(__webpack_require__(16));var _eui=__webpack_require__(18);var _react2=__webpack_require__(17);var _i18n=__webpack_require__(19);var _reporting=__webpack_require__(23);function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap;_getRequireWildcardCache=function _getRequireWildcardCache(){return cache};return cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj}}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj.default=obj;if(cache){cache.set(obj,newObj)}return newObj}function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _createSuper(Derived){return function(){var Super=_getPrototypeOf(Derived),result;if(_isNativeReflectConstruct()){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var openFlyOutHandler;function openFlyOut(dashboard,edit){openFlyOutHandler(dashboard,edit)}var closeFlyOutHandler;function closeFlyOut(){closeFlyOutHandler()}var EzreportingHistoryFlyout=function(_Component){_inherits(EzreportingHistoryFlyout,_Component);var _super=_createSuper(EzreportingHistoryFlyout);function EzreportingHistoryFlyout(props){var _this;_classCallCheck(this,EzreportingHistoryFlyout);_this=_super.call(this,props);_defineProperty(_assertThisInitialized(_this),"showDetails",(function(historyItem){var expandedRows=_objectSpread({},_this.state.expandedRows);var _historyItem$logs=historyItem.logs,logs=_historyItem$logs===void 0?[]:_historyItem$logs;var columns=[{field:"date",name:_i18n.i18n.translate("ezReporting.date",{defaultMessage:"Date"}),align:"left",dataType:"date",width:"180px"},{field:"type",name:_i18n.i18n.translate("ezReporting.type",{defaultMessage:"Type"}),width:"80px",render:function render(type){var colors={error:"danger",info:"primary",warn:"warning"};return(_react.default.createElement(_eui.EuiBadge,{color:colors[type]||"hollow"},type))}},{field:"message",name:_i18n.i18n.translate("ezReporting.message",{defaultMessage:"Message"}),align:"left"}];expandedRows[historyItem.id]=_react.default.createElement(_react.Fragment,null,_react.default.createElement(_eui.EuiBasicTable,{items:logs,columns:columns}));_this.setState({expandedRows:expandedRows})}));_defineProperty(_assertThisInitialized(_this),"hideDetails",(function(historyId){var expandedRows=_objectSpread({},_this.state.expandedRows);delete expandedRows[historyId];_this.setState({expandedRows:expandedRows})}));_defineProperty(_assertThisInitialized(_this),"toggleDetails",(function(historyItem){var rowsExpanded=_objectSpread({},_this.state.expandedRows);if(rowsExpanded[historyItem.id]){_this.hideDetails(historyItem.id)}else{_this.showDetails(historyItem)}}));_defineProperty(_assertThisInitialized(_this),"refresh",_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var _this$state,taskId,expandedRows,historyItems,resp;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this$state=_this.state,taskId=_this$state.taskId,expandedRows=_this$state.expandedRows;_this.setState({refreshing:true});_context.prev=2;_context.next=5;return _reporting.httpClient.get("/api/ezreporting/tasks/".concat(taskId,"/history"));case 5:resp=_context.sent;historyItems=resp;_context.next=12;break;case 9:_context.prev=9;_context.t0=_context["catch"](2);_reporting.toasts.addDanger({title:"Error",text:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.historyError",defaultMessage:"An error occurred while loading the history."})});case 12:historyItems=historyItems||[];Object.keys(expandedRows).forEach((function(historyId){var historyItem=historyItems.find((function(item){return item.id===historyId}));if(historyItem){_this.showDetails(historyItem)}else{_this.hideDetails(historyId)}}));_this.setState({refreshing:false,historyItems:historyItems});case 15:case"end":return _context.stop()}}}),_callee,null,[[2,9]])}))));_defineProperty(_assertThisInitialized(_this),"open",function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(taskId){return regeneratorRuntime.wrap((function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(!taskId||!_reporting.capabilities.show)){_context2.next=2;break}return _context2.abrupt("return");case 2:_this.setState({taskId:taskId,historyItems:[],isFlyoutVisible:true},_this.refresh);case 3:case"end":return _context2.stop()}}}),_callee2)})));return function(_x){return _ref2.apply(this,arguments)}}());_defineProperty(_assertThisInitialized(_this),"close",(function(){_this.setState({isFlyoutVisible:false})}));_defineProperty(_assertThisInitialized(_this),"onTableChange",(function(_ref3){var _ref3$page=_ref3.page,page=_ref3$page===void 0?{}:_ref3$page;var pageIndex=page.index,pageSize=page.size;_this.setState({pageIndex:pageIndex,pageSize:pageSize})}));_this.state={taskId:null,refreshing:false,isFlyoutVisible:false,historyItems:[],pageIndex:0,pageSize:10,expandedRows:{}};openFlyOutHandler=_this.open;closeFlyOutHandler=_this.close;return _this}_createClass(EzreportingHistoryFlyout,[{key:"render",value:function render(){var _this2=this;var _this$state2=this.state,refreshing=_this$state2.refreshing,isFlyoutVisible=_this$state2.isFlyoutVisible,historyItems=_this$state2.historyItems,expandedRows=_this$state2.expandedRows,pageIndex=_this$state2.pageIndex,pageSize=_this$state2.pageSize;if(!isFlyoutVisible){return _react.default.createElement(_react.Fragment,null)}var columns=[{field:"startTime",name:_i18n.i18n.translate("ezReporting.date",{defaultMessage:"Date"}),sortable:true,dataType:"date",align:"left"},{field:"status",name:_i18n.i18n.translate("ezReporting.status",{defaultMessage:"Status"}),sortable:true,align:"left",width:"140px",render:function render(status){switch(status){case"error":return _react.default.createElement(_eui.EuiHealth,{color:"danger"},_i18n.i18n.translate("ezReporting.error",{defaultMessage:"Error"}));case"completed":return _react.default.createElement(_eui.EuiHealth,{color:"success"},_i18n.i18n.translate("ezReporting.completed",{defaultMessage:"Completed"}));case"pending":return _react.default.createElement(_eui.EuiHealth,{color:"primary"},_i18n.i18n.translate("ezReporting.pending",{defaultMessage:"Pending"}));case"ongoing":return _react.default.createElement(_eui.EuiHealth,{color:"primary"},_i18n.i18n.translate("ezReporting.ongoing",{defaultMessage:"Ongoing"}));default:return _react.default.createElement(_eui.EuiHealth,{color:"subdued"},_i18n.i18n.translate("ezReporting.unknown",{defaultMessage:"Unknown"}))}}},{field:"executionTime",name:_i18n.i18n.translate("ezReporting.executionTime",{defaultMessage:"Execution time"}),sortable:true,align:"right",width:"140px",render:function render(executionTime){return(0,_reporting.ms2Str)(executionTime)}},{align:"right",width:"40px",isExpander:true,render:function render(item){return _react.default.createElement(_eui.EuiButtonIcon,{onClick:function onClick(){return _this2.toggleDetails(item)},"aria-label":expandedRows[item.id]?"Collapse":"Expand",iconType:expandedRows[item.id]?"arrowUp":"arrowDown"})}}];var pagination={pageIndex:pageIndex,pageSize:pageSize,totalItemCount:historyItems.length,pageSizeOptions:[10,20,30],hidePerPageOptions:false};var startIndex=pageIndex*pageSize;var endIndex=Math.min(startIndex+pageSize,historyItems.length);return(_react.default.createElement(_eui.EuiFlyout,{onClose:this.close,size:"m","aria-labelledby":"flyoutSmallTitle"},_react.default.createElement(_eui.EuiFlyoutHeader,{hasBorder:true},_react.default.createElement(_eui.EuiTitle,{size:"m"},_react.default.createElement("h2",null,_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.history",defaultMessage:"History"})))),_react.default.createElement(_eui.EuiFlyoutBody,null,_react.default.createElement(_eui.EuiBasicTable,{items:historyItems.slice(startIndex,endIndex),itemId:"id",itemIdToExpandedRowMap:this.state.expandedRows,isExpandable:true,columns:columns,pagination:pagination,onChange:this.onTableChange})),_react.default.createElement(_eui.EuiFlyoutFooter,null,_react.default.createElement(_eui.EuiFlexGroup,{justifyContent:"flexEnd"},_react.default.createElement(_eui.EuiFlexItem,{grow:false},_react.default.createElement(_eui.EuiButton,{iconType:"refresh",onClick:this.refresh,isLoading:refreshing,fill:true},_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.refresh",defaultMessage:"Refresh"})))))))}}]);return EzreportingHistoryFlyout}(_react.Component);exports.EzreportingHistoryFlyout=EzreportingHistoryFlyout},26:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EzreportingApp=void 0;var _react=_interopRequireWildcard(__webpack_require__(16));var _react2=__webpack_require__(17);var _reactRouterDom=__webpack_require__(21);var _eui=__webpack_require__(18);var _i18n=__webpack_require__(19);var _common=__webpack_require__(2);var _table=__webpack_require__(27);var _edit=__webpack_require__(24);var _history=__webpack_require__(25);var _reporting=__webpack_require__(23);function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap;_getRequireWildcardCache=function _getRequireWildcardCache(){return cache};return cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj}}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj.default=obj;if(cache){cache.set(obj,newObj)}return newObj}function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _createSuper(Derived){return function(){var Super=_getPrototypeOf(Derived),result;if(_isNativeReflectConstruct()){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var EzreportingApp=function(_Component){_inherits(EzreportingApp,_Component);var _super=_createSuper(EzreportingApp);function EzreportingApp(props){var _this;_classCallCheck(this,EzreportingApp);_this=_super.call(this,props);_defineProperty(_assertThisInitialized(_this),"componentDidMount",(function(){_this.refreshData();_this.polling()}));_defineProperty(_assertThisInitialized(_this),"componentWillUnmount",(function(){clearTimeout(_this.state.interval);_this.setState({interval:null})}));_defineProperty(_assertThisInitialized(_this),"polling",(function(){var _this$state=_this.state,tasks=_this$state.tasks,tasksInProgress=_this$state.tasksInProgress;if(tasks.length){var tmp=JSON.parse(JSON.stringify(tasksInProgress));tasks.forEach((function(_ref){var _id=_ref._id;_reporting.httpClient.get("/api/ezreporting/tasks/".concat(_id,"/history")).then((function(_ref2){var _ref3=_slicedToArray(_ref2,1),history=_ref3[0];var status=history.status,logs=history.logs,startTime=history.startTime,endTime=history.endTime;if(status!=="success"){if(new Date(endTime).toISOString()<=(new Date).toISOString()){var log=logs.find((function(_ref4){var type=_ref4.type;return type==="error"}));tmp[_id]={status:status,log:log?log.message:"",startTime:startTime,endTime:endTime}}}}));_this.setState({tasksInProgress:tmp})}))}_this.setState({interval:setTimeout(_this.polling,_this.state.delay)})}));_defineProperty(_assertThisInitialized(_this),"refreshData",(function(){var admin=_this.props.admin;_reporting.httpClient.get("/api/ezreporting/tasks/".concat(admin?"admin":"user")).then((function(res){_this.setState({tasks:res.tasks,dashboards:res.dashboards,frequencies:res.frequencies,spaces:_this.props.admin?res.spaces:[],reportingName:res.reportingName})})).catch((function(err){if(err.code===403){_this.setState({accessDenied:true})}return _reporting.toasts.addDanger({title:"Error",text:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.errorOccured",defaultMessage:"An error occurred while loading the data."})})}))}));_defineProperty(_assertThisInitialized(_this),"editTaskHandler",(function(task){if(_reporting.capabilities.edit){var body=JSON.stringify({dashboardId:task.dashboardId,frequency:task.reporting.frequency,emails:task.reporting.emails,print:task.reporting.print,space:task.namespace});return _reporting.httpClient.patch("/api/ezreporting/tasks/".concat(task._id),{body:body}).then((function(){var index=_this.state.tasks.findIndex((function(_ref5){var _id=_ref5._id;return _id===task._id}));_this.refreshData();_reporting.toasts.addSuccess({title:"Success",text:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.editingSuccess",defaultMessage:"Task edited successfully."})});_this.closeEditFlyOut();_this.forceUpdate()}))}}));_defineProperty(_assertThisInitialized(_this),"closeEditFlyOut",(function(){_this.setState({dashboardsBySpace:[],currentSpaces:[]});(0,_edit.closeFlyOut)()}));_defineProperty(_assertThisInitialized(_this),"saveTaskHandler",(function(task){if(_reporting.capabilities.create){var tasks=_this.state.tasks;var body=JSON.stringify({dashboardId:task.dashboardId,frequency:task.reporting.frequency,emails:task.reporting.emails,print:task.reporting.print,space:task.namespace});return _reporting.httpClient.post("/api/ezreporting/tasks",{body:body}).then((function(res){_this.refreshData();_this.setState({dashboardsBySpace:[],currentSpaces:[]});_reporting.toasts.addSuccess({title:"Success",text:_react.default.createElement(_react2.FormattedMessage,{id:"ezreporting.editingSuccess",defaultMessage:"Task edited successfully."})});_this.closeEditFlyOut();_this.forceUpdate()}))}}));_defineProperty(_assertThisInitialized(_this),"downloadManyTask",(function(){var selectedItems=_this.state.selectedItems;if(_reporting.capabilities.download&&selectedItems.length){selectedItems.forEach((function(_ref6){var _id=_ref6._id;_reporting.httpClient.get("/api/ezreporting/tasks/".concat(_id,"/download")).then((function(){_reporting.toasts.addSuccess({title:"Success",text:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.generated",defaultMessage:"Your report will be sent to you by email."})})})).catch((function(){_reporting.toasts.addDanger({title:"Error",text:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.generationError",defaultMessage:"An error occurred while generating the report."})})}))}))}}));_defineProperty(_assertThisInitialized(_this),"onChange",(function(selectedSpaces){_this.setState({selectedSpaces:selectedSpaces})}));_defineProperty(_assertThisInitialized(_this),"onSelectionChangeHandler",(function(selectedItems){_this.setState({selectedItems:selectedItems})}));_defineProperty(_assertThisInitialized(_this),"removeManyTasks",(function(){var selectedItems=_this.state.selectedItems;if(_reporting.capabilities.delete&&selectedItems.length){selectedItems.forEach((function(_ref7){var _id=_ref7._id;_reporting.httpClient.delete("/api/ezreporting/tasks/".concat(_id)).then((function(){_this.refreshData();_reporting.toasts.addSuccess({title:"Success",text:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.removalSuccess",defaultMessage:"Task removed successfully."})})})).catch((function(){_reporting.toasts.addDanger({title:"Error",text:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.removalError",defaultMessage:"An error occurred during the removal task."})})}))}));_this.closeDestroyModal()}}));_defineProperty(_assertThisInitialized(_this),"openDestroyModal",(function(){_this.setState({showDestroyModal:true})}));_defineProperty(_assertThisInitialized(_this),"closeDestroyModal",(function(){_this.setState({showDestroyModal:false})}));_defineProperty(_assertThisInitialized(_this),"closePopover",(function(){_this.setState({isPopoverOpen:false})}));_defineProperty(_assertThisInitialized(_this),"onButtonClick",(function(){_this.setState({isPopoverOpen:true})}));_defineProperty(_assertThisInitialized(_this),"onChangeSpaceHandler",(function(selectedSpaces){var dashboards=_this.state.dashboards;_this.setState({dashboardsBySpace:[],currentSpaces:[]});if(selectedSpaces.length){var space=selectedSpaces[0].label;var dashboardsBySpace=dashboards.filter((function(dashboard){return dashboard.namespace===space}));_this.setState({dashboardsBySpace:dashboardsBySpace,currentSpaces:selectedSpaces})}}));_this.state={tasks:[],dashboards:[],frequencies:[],spaces:[],selectedSpaces:[],reportingName:"Reporting",accessDenied:false,selectedItems:[],showDestroyModal:false,isPopoverOpen:false,dashboardsBySpace:[],currentSpaces:[],delay:5e3,interval:null,tasksInProgress:{}};return _this}_createClass(EzreportingApp,[{key:"render",value:function render(){var _this2=this;var _this$props=this.props,basename=_this$props.basename,navigation=_this$props.navigation,admin=_this$props.admin,applicationName=_this$props.applicationName;var _this$state2=this.state,tasks=_this$state2.tasks,dashboards=_this$state2.dashboards,frequencies=_this$state2.frequencies,spaces=_this$state2.spaces,selectedSpaces=_this$state2.selectedSpaces,accessDenied=_this$state2.accessDenied,selectedItems=_this$state2.selectedItems,showDestroyModal=_this$state2.showDestroyModal,isPopoverOpen=_this$state2.isPopoverOpen,dashboardsBySpace=_this$state2.dashboardsBySpace,currentSpaces=_this$state2.currentSpaces,tasksInProgress=_this$state2.tasksInProgress;if(accessDenied){var defaultMsg="\n        You are not authorized to access Reporting.\n        To use Reporting management, you need the privileges granted by the `reporting` role.\n      ";return(_react.default.createElement(_eui.EuiEmptyPrompt,{iconType:"reportingApp",title:_react.default.createElement("h2",null,_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.accessDeniedTitle",defaultMessage:"Access denied"})),body:_react.default.createElement(_react.Fragment,null,_react.default.createElement("p",null,_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.accessDenied",defaultMessage:defaultMsg}),","))}))}var createBtn;if(_reporting.capabilities.create){createBtn=_react.default.createElement(_eui.EuiButton,{fill:true,iconType:"plusInCircle",isDisabled:dashboards.length>0?false:true,onClick:function onClick(){return dashboards.length>0?(0,_edit.openFlyOut)(null,false):null}},_react.default.createElement(_react2.FormattedMessage,{id:"ezreporting.createNewTask",defaultMessage:"New reporting task"}))}var tasksList=tasks;var searchBar;if(admin){var spacesList=spaces.map((function(space){return{value:space.id,label:space.name,color:space.color}}));var renderOption=function renderOption(option,searchValue,contentClassName){var color=option.color,label=option.label,value=option.value;return(_react.default.createElement(_eui.EuiHealth,{color:color},_react.default.createElement("span",{className:contentClassName},_react.default.createElement(_eui.EuiHighlight,{search:searchValue},label))))};searchBar=_react.default.createElement(_eui.EuiComboBox,{fullWidth:true,options:spacesList,selectedOptions:selectedSpaces,onChange:this.onChange,renderOption:renderOption,placeholder:_i18n.i18n.translate("ezReporting.searcg",{defaultMessage:"Search..."}),isClearable:true,"data-test-subj":"spaceSearch"});if(selectedSpaces.length){var spacesNames=selectedSpaces.map((function(_ref8){var label=_ref8.label;return label}));tasksList=tasks.filter((function(_ref9){var namespace=_ref9.namespace;return spacesNames.includes(namespace)}))}}var destroyModal;if(showDestroyModal){destroyModal=_react.default.createElement(_eui.EuiOverlayMask,null,_react.default.createElement(_eui.EuiConfirmModal,{title:_i18n.i18n.translate("ezReporting.questionDeleteTasks",{defaultMessage:"Are you sure you want to delete these tasks ?"}),onCancel:this.closeDestroyModal,onConfirm:this.removeManyTasks,cancelButtonText:"Cancel",confirmButtonText:"Yes, delete tasks",buttonColor:"danger",defaultFocusedButton:"confirm"},_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.confirmDeleteTasks",defaultMessage:"Are you about to delete the selected tasks."})))}var panels=[{id:0,items:[{name:_i18n.i18n.translate("ezReporting.generate",{defaultMessage:"Generate"}),icon:_react.default.createElement(_eui.EuiIcon,{type:"importAction",size:"m"}),onClick:function onClick(){_this2.downloadManyTask()}},{name:_i18n.i18n.translate("ezReporting.remove",{defaultMessage:"Delete"}),icon:"trash",onClick:function onClick(){_this2.openDestroyModal()}}]}];var button=_react.default.createElement(_eui.EuiButton,{iconType:"arrowDown",iconSide:"right",onClick:this.onButtonClick},"Manage ",selectedItems.length," task(s)");var popover;if(selectedItems.length){popover=_react.default.createElement(_eui.EuiFlexItem,{grow:false},_react.default.createElement(_eui.EuiPopover,{id:"manageTasks",button:button,isOpen:isPopoverOpen,closePopover:this.closePopover,panelPaddingSize:"none",anchorPosition:"downLeft"},_react.default.createElement(_eui.EuiContextMenu,{initialPanelId:0,panels:panels})))}return(_react.default.createElement(_reactRouterDom.BrowserRouter,{basename:basename},_react.default.createElement(_edit.EzreportingTaskEditFlyout,{dashboards:dashboards,dashboardsBySpace:dashboardsBySpace,frequencies:frequencies,spaces:spaces,currentSpaces:currentSpaces,admin:admin,editTaskHandler:this.editTaskHandler,saveTaskHandler:this.saveTaskHandler,onChangeSpaceHandler:this.onChangeSpaceHandler}),_react.default.createElement(_history.EzreportingHistoryFlyout,null),destroyModal,_react.default.createElement(_react2.I18nProvider,null,_react.default.createElement(_react.default.Fragment,null,_react.default.createElement(navigation.ui.TopNavMenu,{appName:_common.PLUGIN_ID,showSearchBar:false}),_react.default.createElement(_eui.EuiPage,{restrictWidth:"1000px"},_react.default.createElement(_eui.EuiPageBody,null,_react.default.createElement(_eui.EuiPageContent,null,_react.default.createElement(_eui.EuiPageContentHeader,null,_react.default.createElement(_eui.EuiPageContentHeaderSection,null,_react.default.createElement(_eui.EuiTitle,null,_react.default.createElement("h2",null,_react.default.createElement(_react2.FormattedMessage,{id:"ezreporting.title",defaultMessage:"{name}",values:{name:"".concat(_common.PLUGIN_NAME," ").concat(applicationName)}})))),_react.default.createElement(_eui.EuiPageContentHeaderSection,null,createBtn)),_react.default.createElement(_eui.EuiPageContentBody,null,_react.default.createElement(_eui.EuiSpacer,{size:"s"}),_react.default.createElement(_eui.EuiFlexGroup,null,popover,_react.default.createElement(_eui.EuiFlexItem,null,searchBar)),_react.default.createElement(_eui.EuiSpacer,null),_react.default.createElement(_table.EzreportingTable,{tasks:tasksList,tasksInProgress:tasksInProgress,spaces:spaces,dashboards:dashboards,frequencies:frequencies,admin:this.props.admin,onSelectionChangeHandler:this.onSelectionChangeHandler})))))))))}}]);return EzreportingApp}(_react.Component);exports.EzreportingApp=EzreportingApp},27:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EzreportingTable=void 0;var _react=_interopRequireWildcard(__webpack_require__(16));var _i18n=__webpack_require__(19);var _react2=__webpack_require__(17);var _eui=__webpack_require__(18);var _moment=_interopRequireDefault(__webpack_require__(22));var _edit=__webpack_require__(24);var _history=__webpack_require__(25);var _reporting=__webpack_require__(23);var _printer=_interopRequireDefault(__webpack_require__(29));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap;_getRequireWildcardCache=function _getRequireWildcardCache(){return cache};return cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj}}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj.default=obj;if(cache){cache.set(obj,newObj)}return newObj}function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _createSuper(Derived){return function(){var Super=_getPrototypeOf(Derived),result;if(_isNativeReflectConstruct()){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var EzreportingTable=function(_Component){_inherits(EzreportingTable,_Component);var _super=_createSuper(EzreportingTable);function EzreportingTable(props){var _this;_classCallCheck(this,EzreportingTable);_this=_super.call(this,props);_defineProperty(_assertThisInitialized(_this),"toggleDetails",(function(item){var itemIdToExpandedRowMap=_objectSpread({},_this.state.itemIdToExpandedRowMap);if(itemIdToExpandedRowMap[item._id]){delete itemIdToExpandedRowMap[item._id];return _this.setState({itemIdToExpandedRowMap:itemIdToExpandedRowMap})}var reporting=item.reporting;var receivers=Array.isArray(reporting.emails)?reporting.emails.join(", "):reporting.emails;var dsh=_this.props.dashboards.find((function(_ref){var id=_ref.id,namespace=_ref.namespace;if(id!==item.dashboardId&&namespace!==item.namespace){return false}return true}));var listItems=[{title:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.dashboardDescription",defaultMessage:"Description"}),description:dsh.description||"N/A"},{title:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.receiversEmails",defaultMessage:"Receivers' email addresses"}),description:receivers},{title:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.nextReport",defaultMessage:"Next report"}),description:reporting.runAt?(0,_moment.default)(reporting.runAt).format("YYYY-MM-DD hh:mm"):"N/A"},{title:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.createdAt",defaultMessage:"Creation date"}),description:reporting.createdAt?(0,_moment.default)(reporting.createdAt).format("YYYY-MM-DD"):"N/A"}];itemIdToExpandedRowMap[item._id]=_react.default.createElement(_eui.EuiDescriptionList,{listItems:listItems});return _this.setState({itemIdToExpandedRowMap:itemIdToExpandedRowMap})}));_defineProperty(_assertThisInitialized(_this),"onTableChange",(function(_ref2){var _ref2$page=_ref2.page,page=_ref2$page===void 0?{}:_ref2$page,_ref2$sort=_ref2.sort,sort=_ref2$sort===void 0?{}:_ref2$sort;var pageIndex=page.index,pageSize=page.size;var sortField=sort.field,sortDirection=sort.direction;_this.setState({pageIndex:pageIndex,pageSize:pageSize,sortField:sortField,sortDirection:sortDirection})}));_this.state={itemIdToExpandedRowMap:{},pageIndex:0,pageSize:10,sortField:"namespace",sortDirection:"asc",tasksInProgress:{}};return _this}_createClass(EzreportingTable,[{key:"render",value:function render(){var _this2=this;var _this$state=this.state,pageIndex=_this$state.pageIndex,pageSize=_this$state.pageSize,itemIdToExpandedRowMap=_this$state.itemIdToExpandedRowMap,sortField=_this$state.sortField,sortDirection=_this$state.sortDirection;var _this$props=this.props,tasks=_this$props.tasks,tasksInProgress=_this$props.tasksInProgress,spaces=_this$props.spaces,dashboards=_this$props.dashboards,frequencies=_this$props.frequencies,onSelectionChangeHandler=_this$props.onSelectionChangeHandler;var actions=[];if(_reporting.capabilities.edit){actions.push({name:_i18n.i18n.translate("ezReporting.edit",{defaultMessage:"Edit"}),description:_i18n.i18n.translate("ezReporting.edit",{defaultMessage:"Edit"}),icon:"pencil",type:"icon",color:"primary",onClick:function onClick(el){if(el.exists){return(0,_edit.openFlyOut)(el,true)}return _reporting.toasts.addDanger({title:"Error",text:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.dashboardNotFound",values:{DASHBOARD_ID:el.dashboardId},defaultMessage:"Dashboard nof found or remove (id: {DASHBOARD_ID})"})})}})}if(_reporting.capabilities.edit){actions.push({name:_i18n.i18n.translate("ezReporting.clone",{defaultMessage:"Clone"}),description:_i18n.i18n.translate("ezReporting.clone",{defaultMessage:"Clone"}),icon:"copy",type:"icon",color:"primary",onClick:function onClick(el){if(el.exists){return(0,_edit.openFlyOut)(el,false)}return _reporting.toasts.addDanger({title:"Error",text:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.dashboardNotFound",values:{DASHBOARD_ID:el.dashboardId},defaultMessage:"Dashboard nof found or remove (id: {DASHBOARD_ID})"})})}})}if(_reporting.capabilities.show){actions.push({name:_i18n.i18n.translate("ezReporting.history",{defaultMessage:"History"}),description:_i18n.i18n.translate("ezReporting.history",{defaultMessage:"History"}),icon:"clock",type:"icon",color:"primary",onClick:function onClick(el){if(el.exists){(0,_history.openFlyOut)(el._id,false)}}})}var columns=[{field:"dashboardId",name:_i18n.i18n.translate("ezReporting.dashboard",{defaultMessage:"Dashboard"}),description:_i18n.i18n.translate("ezReporting.dashboardName",{defaultMessage:"Dashboard name"}),align:"left",render:function render(dashboardId,_ref3){var _id=_ref3._id,reporting=_ref3.reporting;if(dashboardId){var dashboard=dashboards.find((function(_ref4){var id=_ref4.id;return id===dashboardId}));if(dashboard){var print;if(reporting.print){print=_react.default.createElement(_react.Fragment,null," ",_react.default.createElement(_eui.EuiToolTip,{position:"right",content:_i18n.i18n.translate("ezReporting.optimizedForPrinting",{defaultMessage:"Optimized for printing"})},_react.default.createElement(_eui.EuiImage,{alt:_i18n.i18n.translate("ezReporting.optimizedForPrinting",{defaultMessage:"Optimized for printing"}),size:14,url:_printer.default})))}var dashboardLink="/app/kibana#/dashboard/".concat(dashboardId);if(_this2.props.admin&&dashboard.namespace!=="default"){dashboardLink="/s/".concat(dashboard.namespace).concat(dashboardLink)}var taskStatus=tasksInProgress[_id];var statusIcon;if(taskStatus){var status=taskStatus.status,log=taskStatus.log;if(status&&status!=="error"){statusIcon=_react.default.createElement(_eui.EuiLoadingSpinner,{size:"m"})}if(status&&status==="error"){statusIcon=_react.default.createElement(_eui.EuiToolTip,{position:"bottom",content:log},_react.default.createElement(_eui.EuiIcon,{type:"alert"}))}}return(_react.default.createElement(_react.Fragment,null,statusIcon,"",_react.default.createElement(_eui.EuiLink,{href:_reporting.httpClient.basePath.prepend(dashboardLink)},dashboard.name),"",print))}}return(_react.default.createElement(_eui.EuiTextColor,{color:"warning"},_react.default.createElement(_eui.EuiIcon,{type:"alert"}),_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.dashboardNotFound",values:{DASHBOARD_ID:dashboardId},defaultMessage:"Dashboard nof found or remove (id: {DASHBOARD_ID})"})));return""}},{field:"reporting.frequency",name:_i18n.i18n.translate("ezReporting.frequency",{defaultMessage:"Frequency"}),description:_i18n.i18n.translate("ezReporting.frequency",{defaultMessage:"Frequency"}),render:function render(frequency){return(0,_reporting.convertFrequency)(frequencies,frequency)},sortable:true,align:"center"},{field:"reporting.sentAt",name:_i18n.i18n.translate("ezReporting.sentAt",{defaultMessage:"Last sent"}),description:_i18n.i18n.translate("ezReporting.sentAt",{defaultMessage:"Last sent"}),align:"center",render:function render(sentAt){if(sentAt&&sentAt!=="1970-01-01T12:00:00.000Z"){return(0,_moment.default)(sentAt).format("YYYY-MM-DD")}return"-"}},{actions:actions,align:"right",width:"32px"},{align:"right",width:"40px",isExpander:true,render:function render(item){return _react.default.createElement(_eui.EuiButtonIcon,{onClick:function onClick(){return _this2.toggleDetails(item)},"aria-label":itemIdToExpandedRowMap[item._id]?"Collapse":"Expand",iconType:itemIdToExpandedRowMap[item._id]?"arrowUp":"arrowDown"})}}];if(this.props.admin){columns.splice(1,0,{field:"namespace",name:_i18n.i18n.translate("ezReporting.space",{defaultMessage:"Space"}),description:_i18n.i18n.translate("ezReporting.space",{defaultMessage:"Space"}),render:function render(namespace){var space=spaces.find((function(_ref5){var name=_ref5.name;return name===namespace}));return(_react.default.createElement(_eui.EuiBadge,{color:space.color},namespace||"-"))},sortable:true,align:"center"})}var pagination={pageIndex:pageIndex,pageSize:pageSize,totalItemCount:tasks.length,pageSizeOptions:[10,20,30],hidePerPageOptions:false};var sorting={sort:{field:sortField,direction:sortDirection}};var startIndex=pageIndex*pageSize;var endIndex=Math.min(startIndex+pageSize,tasks.length);var selection={selectable:function selectable(task){return task===null||task===void 0?void 0:task._id},selectableMessage:function selectableMessage(selectable){return!selectable?_i18n.i18n.translate("ezReporting.invalidTask",{defaultMessage:"Invalid task"}):undefined},onSelectionChange:onSelectionChangeHandler};var items=tasks.slice(startIndex,endIndex).sort((function(a,b){var first=sortField.split(".").reduce((function(o,i){return o[i]}),a);var second=sortField.split(".").reduce((function(o,i){return o[i]}),b);if(sortField==="reporting.frequency"){first=(0,_reporting.convertFrequency)(frequencies,first);second=(0,_reporting.convertFrequency)(frequencies,second)}if(sortDirection==="asc"){return first>second}return first<second}));return(_react.default.createElement(_eui.EuiBasicTable,{items:items,itemId:"_id",itemIdToExpandedRowMap:itemIdToExpandedRowMap,isExpandable:true,hasActions:true,columns:columns,pagination:pagination,sorting:sorting,isSelectable:true,selection:selection,onChange:this.onTableChange}))}}]);return EzreportingTable}(_react.Component);exports.EzreportingTable=EzreportingTable},29:function(module,exports){module.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAACLUlEQVR4Xu2aXWrCQBDHMzZ+o33TBx9SBF9t4gnsDfQGHsEj2Bt4BG9Qj5BewOizIOTB9yj4gYLpFEI2SKZJWlc3Zf+wbCCa+f+cWdZMAkoMdTodCyddua/ms9nMiAqgRgEYhqG5rqsr9xcRMyGAZVm2ruuKqFLjUGIG/GMA6PIEwFgmV4DFYvHJE6DdbvPMAH9hrBQBSAAJIAEkAAQBWq3WM05THORmtVwugScAeviJwMTRQw+b0AwgPWVelAx0vR/4jQJg5gUEYBBM0Gw2WdnE0Gq14lpC6CeEgC4nlSgbwTJAl5PKykZkABoCNE1zlRRLDSWWABJgCgBjb00McepRANBoNEQjmK7X636QBj1+MAjxMzAO2dzGaQJwqL0hLQAjHP0rgCEFAPV63RVxEXul5HhA9CKu1Wrp3sgul8s/2gckgASQABMAmJAdY/7daToWOz/AaRAKAAAjx3Hsa4BqteofbzYbnt1pOhY775AA2+3WFr0vhB4XlUqFXgNCAzDIcIByuaztdjtbTADmkQRAjUql0mi/39siAqC31+s/dlAsFhO5OxwOoHjC797i8escr2kErukm3QfM3/SFCoXCrR6/6n/ItvkN0KM7c7SOx6Odz+fnt8gADRDdmfPLIZfLaTi9kB/2dDqdQOEo9OFSfdCAB39/iGUmm836Fz2fzxwBksdS4wDwv2dIHitRBjKZDFGY3GEi/T3FvtF+jN6TZYDWQ163wWFEAXwBBdZR2IFYWGkAAAAASUVORK5CYII="},3:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.renderApp=void 0;var _react=_interopRequireDefault(__webpack_require__(16));var _reactDom=_interopRequireDefault(__webpack_require__(20));var _app=__webpack_require__(26);var _reporting=__webpack_require__(23);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var renderApp=function renderApp(_ref,_ref2,_ref3,applicationName,admin){var application=_ref.application,notifications=_ref.notifications,http=_ref.http;var navigation=_ref2.navigation;var element=_ref3.element;if(!_reporting.httpClient){(0,_reporting.setHttpClient)(http)}if(!_reporting.toasts){(0,_reporting.setToasts)(notifications.toasts)}if(!_reporting.capabilities){(0,_reporting.setCapabilities)(application.capabilities)}_reactDom.default.render(_react.default.createElement(_app.EzreportingApp,{basename:http.basePath.get(),navigation:navigation,applicationName:applicationName,admin:admin}),element);return function(){return _reactDom.default.unmountComponentAtNode(element)}};exports.renderApp=renderApp}}]);