(window["ezreporting_bundle_jsonpfunction"]=window["ezreporting_bundle_jsonpfunction"]||[]).push([[1],{18:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.renderApp=void 0;var _react=_interopRequireDefault(__webpack_require__(14));var _reactDom=_interopRequireDefault(__webpack_require__(19));var _app=__webpack_require__(25);var _reporting=__webpack_require__(22);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var renderApp=function renderApp(_ref,_ref2,_ref3){var application=_ref.application,notifications=_ref.notifications,http=_ref.http;var navigation=_ref2.navigation;var appBasePath=_ref3.appBasePath,element=_ref3.element;if(!_reporting.httpClient){(0,_reporting.setHttpClient)(http)}if(!_reporting.toasts){(0,_reporting.setToasts)(notifications.toasts)}if(!_reporting.capabilities){(0,_reporting.setCapabilities)(application.capabilities)}_reactDom.default.render(_react.default.createElement(_app.EzreportingApp,{basename:appBasePath,navigation:navigation}),element);return function(){return _reactDom.default.unmountComponentAtNode(element)}};exports.renderApp=renderApp},22:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.setHttpClient=setHttpClient;exports.setToasts=setToasts;exports.setCapabilities=setCapabilities;exports.capabilities=exports.toasts=exports.httpClient=exports.ms2Str=exports.defaultTask=exports.convertFrequency=void 0;var convertFrequency=function convertFrequency(frequencies,frequency){var freq=frequencies.find((function(_ref){var value=_ref.value;return value===frequency}));return freq?freq.text:"Error"};exports.convertFrequency=convertFrequency;var defaultTask=function defaultTask(dashboardId){return{_id:"",dashboardId:dashboardId||null,exists:true,reporting:{frequency:"1w",emails:[],createdAt:"",print:false}}};exports.defaultTask=defaultTask;var ms2Str=function ms2Str(time){var ms=time;var s=Math.floor(ms/1e3);ms%=1e3;var m=Math.floor(s/60);s%=60;var h=Math.floor(m/60);m%=60;if(h){return"".concat(h,"h ").concat(m,"m")}if(m){return"".concat(m,"m ").concat(s,"s")}if(s){return"".concat(s,"s")}return"".concat(ms,"ms")};exports.ms2Str=ms2Str;var httpClient;exports.httpClient=httpClient;function setHttpClient(http){exports.httpClient=httpClient=http}var toasts;exports.toasts=toasts;function setToasts(notifications){exports.toasts=toasts=notifications}var capabilities;exports.capabilities=capabilities;function setCapabilities(capa){exports.capabilities=capabilities=capa.ezreporting||{}}},23:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.openFlyOut=openFlyOut;exports.closeFlyOut=closeFlyOut;exports.EzreportingTaskEditFlyout=void 0;var _react=_interopRequireWildcard(__webpack_require__(14));var _eui=__webpack_require__(16);var _lodash=__webpack_require__(27);var _react2=__webpack_require__(15);var _i18n=__webpack_require__(17);var _reporting=__webpack_require__(22);function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap;_getRequireWildcardCache=function _getRequireWildcardCache(){return cache};return cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj}}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj.default=obj;if(cache){cache.set(obj,newObj)}return newObj}function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _createSuper(Derived){return function(){var Super=_getPrototypeOf(Derived),result;if(_isNativeReflectConstruct()){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var openFlyOutHandler;function openFlyOut(dashboard,edit){openFlyOutHandler(dashboard,edit)}var closeFlyOutHandler;function closeFlyOut(){closeFlyOutHandler()}var EzreportingTaskEditFlyout=function(_Component){_inherits(EzreportingTaskEditFlyout,_Component);var _super=_createSuper(EzreportingTaskEditFlyout);function EzreportingTaskEditFlyout(props){var _this;_classCallCheck(this,EzreportingTaskEditFlyout);_this=_super.call(this,props);_defineProperty(_assertThisInitialized(_this),"open",(function(dashboard,edit){var currentTask=JSON.parse(JSON.stringify(dashboard||(0,_reporting.defaultTask)(_this.props.dashboards[0].id)));var currentFrequency=(0,_lodash.get)(currentTask,"reporting.frequency");var frequency=_this.props.frequencies.find((function(f){return f.value===currentFrequency}));var receivers=(0,_lodash.get)(currentTask,"reporting.emails",[]);if(typeof receivers==="string"){receivers=receivers.split(",").map((function(e){return e.trim()}))}if(!frequency&&_this.props.frequencies.length>0){(0,_lodash.set)(currentTask,"reporting.frequency",_this.props.frequencies[0].value)}_this.setState({isFlyoutVisible:true,currentTask:currentTask,edit:edit,receivers:receivers,email:"",mailErrorMessages:[],dashboardErrorMessages:[]})}));_defineProperty(_assertThisInitialized(_this),"close",(function(){_this.setState({isFlyoutVisible:false})}));_defineProperty(_assertThisInitialized(_this),"onChangeDashboard",(function(selectedDashboards){var dashboard=selectedDashboards[0];var currentTask=_objectSpread({},_this.state.currentTask);currentTask.dashboardId=dashboard&&dashboard.value;var dashboardErrorMessages=[];if(!currentTask.dashboardId){dashboardErrorMessages.push(_i18n.i18n.translate("ezReporting.pleaseSelectDashboard",{defaultMessage:"Please select a dashboard"}))}_this.setState({currentTask:currentTask,dashboardErrorMessages:dashboardErrorMessages})}));_defineProperty(_assertThisInitialized(_this),"onChangeFrequency",(function(event){var currentTask=_objectSpread({},_this.state.currentTask);currentTask.reporting.frequency=event.target.value;_this.setState({currentTask:currentTask})}));_defineProperty(_assertThisInitialized(_this),"onChangeEmail",(function(event){_this.setState({email:event.target.value})}));_defineProperty(_assertThisInitialized(_this),"onChangeLayout",(function(event){var currentTask=_objectSpread({},_this.state.currentTask);currentTask.reporting.print=event.target.checked;_this.setState({currentTask:currentTask})}));_defineProperty(_assertThisInitialized(_this),"addReceiver",function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(event){var _this$state,email,receivers,body,resp,exists;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();_this$state=_this.state,email=_this$state.email,receivers=_this$state.receivers;_context.prev=2;body=JSON.stringify({email:email});_context.next=6;return _reporting.httpClient.post("/api/ezreporting/email",{body:body});case 6:resp=_context.sent;exists=receivers.includes(email);_this.setState({email:"",mailErrorMessages:[],receivers:exists?receivers:receivers.concat([email])});_context.next=14;break;case 11:_context.prev=11;_context.t0=_context["catch"](2);_this.setState({mailErrorMessages:[_i18n.i18n.translate("ezReporting.pleaseEnterValidEmail",{defaultMessage:"Please enter a valid email address"})]});case 14:case"end":return _context.stop()}}}),_callee,null,[[2,11]])})));return function(_x){return _ref.apply(this,arguments)}}());_defineProperty(_assertThisInitialized(_this),"removeReceiver",(function(email){_this.setState({receivers:_this.state.receivers.filter((function(r){return r!==email}))})}));_defineProperty(_assertThisInitialized(_this),"saveOrUpdate",(function(){if(_reporting.capabilities.save){var _this$state2=_this.state,edit=_this$state2.edit,currentTask=_this$state2.currentTask,receivers=_this$state2.receivers;(0,_lodash.set)(currentTask,"reporting.emails",receivers);if(edit){return _this.props.editTaskHandler(currentTask).catch((function(err){return _reporting.toasts.addDanger({title:"Error",text:(0,_lodash.get)(err,"data.error","Error")})}))}return _this.props.saveTaskHandler(currentTask).catch((function(err){return _reporting.toasts.addDanger({title:"Error",text:(0,_lodash.get)(err,"data.error","Error")})}))}}));_this.state={isFlyoutVisible:false,edit:false,currentTask:null,email:"",receivers:[],mailErrorMessages:[],dashboardErrorMessages:[]};openFlyOutHandler=_this.open;closeFlyOutHandler=_this.close;return _this}_createClass(EzreportingTaskEditFlyout,[{key:"render",value:function render(){var _this2=this;var _this$state3=this.state,isFlyoutVisible=_this$state3.isFlyoutVisible,currentTask=_this$state3.currentTask,edit=_this$state3.edit,mailErrorMessages=_this$state3.mailErrorMessages,dashboardErrorMessages=_this$state3.dashboardErrorMessages,receivers=_this$state3.receivers;var _this$props=this.props,dashboards=_this$props.dashboards,frequencies=_this$props.frequencies;var flytOut=_react.default.createElement(_eui.EuiFlyout,{onClose:this.close,size:"m"},_react.default.createElement(_eui.EuiFlyoutHeader,{hasBorder:true},_react.default.createElement(_eui.EuiFlexGroup,{alignItems:"center"},_react.default.createElement(_eui.EuiFlexItem,null,_react.default.createElement(_eui.EuiTitle,{size:"s"},_react.default.createElement("h3",{id:"flyoutTitle"},_react.default.createElement(_react2.FormattedMessage,{defaultMessage:"Log event document details",id:"xpack.infra.logFlyout.flyoutTitle"})))),_react.default.createElement(_eui.EuiFlexItem,{grow:false},"lortem"))),_react.default.createElement(_eui.EuiFlyoutBody,null,"lorem"));var dashboardList=dashboards.map((function(dashboard){return{value:dashboard.id,label:dashboard.name}}));var invalidMail=mailErrorMessages.length>0;var invalidDashboard=dashboardErrorMessages.length>0;var invalidForm=invalidDashboard||receivers.length===0;var saveBtn;if(_reporting.capabilities.save){saveBtn=_react.default.createElement(_eui.EuiFormRow,{fullWidth:true},_react.default.createElement(_eui.EuiButton,{fill:true,iconType:"save",type:"submit",onClick:function onClick(){return _this2.saveOrUpdate()},disabled:invalidForm,fullWidth:true},_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.save",defaultMessage:"Save"})))}if(!isFlyoutVisible){return _react.default.createElement(_react.Fragment,null)}var title;if(edit){title=_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.editingTask",defaultMessage:"Editing a reporting task"})}else{title=_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.creatingTask",defaultMessage:"Creating a reporting task"})}var receiverItems=receivers.map((function(email,index){return _react.default.createElement(_eui.EuiListGroupItem,{key:index,label:email,extraAction:{iconType:"trash",iconSize:"s","aria-label":"remove receiver ".concat(email),onClick:function onClick(){_this2.removeReceiver(email)}}})}));var receiversList;if(receiverItems.length>0){receiversList=_react.default.createElement(_eui.EuiFormRow,{fullWidth:true},_react.default.createElement(_eui.EuiListGroup,{maxWidth:false,bordered:true},receiverItems))}var selectedDashboards=dashboardList.filter((function(d){return d.value===currentTask.dashboardId}));var flyOutContent=_react.default.createElement(_eui.EuiForm,null,_react.default.createElement(_eui.EuiFormRow,{fullWidth:true,label:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.dashboard",defaultMessage:"Dashboard"}),isInvalid:invalidDashboard,error:dashboardErrorMessages},_react.default.createElement(_eui.EuiComboBox,{fullWidth:true,placeholder:_i18n.i18n.translate("ezReporting.selectDashboard",{defaultMessage:"Select a dashboard"}),singleSelection:{asPlainText:true},options:dashboardList,selectedOptions:selectedDashboards,onChange:this.onChangeDashboard,isClearable:true,isInvalid:invalidDashboard})),_react.default.createElement(_eui.EuiFormRow,{fullWidth:true,label:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.frequency",defaultMessage:"Frequency"})},_react.default.createElement(_eui.EuiSelect,{fullWidth:true,options:frequencies,value:currentTask.reporting.frequency,"aria-label":_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.frequency",defaultMessage:"Frequency"}),onChange:this.onChangeFrequency})),_react.default.createElement(_eui.EuiSpacer,{size:"m"}),_react.default.createElement("form",{onSubmit:this.addReceiver},_react.default.createElement(_eui.EuiFlexGroup,null,_react.default.createElement(_eui.EuiFlexItem,null,_react.default.createElement(_eui.EuiFormRow,{label:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.receiversEmails",defaultMessage:"Receivers' email addresses"}),fullWidth:true,isInvalid:invalidMail,error:mailErrorMessages},_react.default.createElement(_eui.EuiFieldText,{fullWidth:true,placeholder:"Email",value:this.state.email,onChange:this.onChangeEmail}))),_react.default.createElement(_eui.EuiFlexItem,{grow:false},_react.default.createElement(_eui.EuiFormRow,{hasEmptyLabelSpace:true},_react.default.createElement(_eui.EuiButton,{iconType:"plusInCircle",type:"submit"},_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.add",defaultMessage:"Add"})))))),_react.default.createElement(_eui.EuiSpacer,{size:"m"}),receiversList,_react.default.createElement(_eui.EuiFormRow,{fullWidth:true},_react.default.createElement(_eui.EuiCheckbox,{id:"optimize-checkbox",checked:currentTask.reporting.print,label:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.optimizedForPrinting",defaultMessage:"Optimized for printing"}),onChange:this.onChangeLayout})),saveBtn);return(_react.default.createElement(_eui.EuiFlyout,{onClose:this.close,size:"m","aria-labelledby":"flyoutSmallTitle"},_react.default.createElement(_eui.EuiFlyoutHeader,{hasBorder:true},_react.default.createElement(_eui.EuiTitle,{size:"m"},_react.default.createElement("h2",null,title))),_react.default.createElement(_eui.EuiFlyoutBody,null,flyOutContent)))}}]);return EzreportingTaskEditFlyout}(_react.Component);exports.EzreportingTaskEditFlyout=EzreportingTaskEditFlyout},24:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.openFlyOut=openFlyOut;exports.closeFlyOut=closeFlyOut;exports.EzreportingHistoryFlyout=void 0;var _react=_interopRequireWildcard(__webpack_require__(14));var _eui=__webpack_require__(16);var _react2=__webpack_require__(15);var _i18n=__webpack_require__(17);var _reporting=__webpack_require__(22);function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap;_getRequireWildcardCache=function _getRequireWildcardCache(){return cache};return cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj}}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj.default=obj;if(cache){cache.set(obj,newObj)}return newObj}function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _createSuper(Derived){return function(){var Super=_getPrototypeOf(Derived),result;if(_isNativeReflectConstruct()){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var openFlyOutHandler;function openFlyOut(dashboard,edit){openFlyOutHandler(dashboard,edit)}var closeFlyOutHandler;function closeFlyOut(){closeFlyOutHandler()}var EzreportingHistoryFlyout=function(_Component){_inherits(EzreportingHistoryFlyout,_Component);var _super=_createSuper(EzreportingHistoryFlyout);function EzreportingHistoryFlyout(props){var _this;_classCallCheck(this,EzreportingHistoryFlyout);_this=_super.call(this,props);_defineProperty(_assertThisInitialized(_this),"showDetails",(function(historyItem){var expandedRows=_objectSpread({},_this.state.expandedRows);var _historyItem$logs=historyItem.logs,logs=_historyItem$logs===void 0?[]:_historyItem$logs;var columns=[{field:"date",name:_i18n.i18n.translate("ezReporting.date",{defaultMessage:"Date"}),align:"left",dataType:"date",width:"180px"},{field:"type",name:_i18n.i18n.translate("ezReporting.type",{defaultMessage:"Type"}),width:"80px",render:function render(type){var colors={error:"danger",info:"primary",warn:"warning"};return(_react.default.createElement(_eui.EuiBadge,{color:colors[type]||"hollow"},type))}},{field:"message",name:_i18n.i18n.translate("ezReporting.message",{defaultMessage:"Message"}),align:"left"}];expandedRows[historyItem.id]=_react.default.createElement(_react.Fragment,null,_react.default.createElement(_eui.EuiBasicTable,{items:logs,columns:columns}));_this.setState({expandedRows:expandedRows})}));_defineProperty(_assertThisInitialized(_this),"hideDetails",(function(historyId){var expandedRows=_objectSpread({},_this.state.expandedRows);delete expandedRows[historyId];_this.setState({expandedRows:expandedRows})}));_defineProperty(_assertThisInitialized(_this),"toggleDetails",(function(historyItem){var rowsExpanded=_objectSpread({},_this.state.expandedRows);if(rowsExpanded[historyItem.id]){_this.hideDetails(historyItem.id)}else{_this.showDetails(historyItem)}}));_defineProperty(_assertThisInitialized(_this),"refresh",_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var _this$state,taskId,expandedRows,historyItems,resp;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this$state=_this.state,taskId=_this$state.taskId,expandedRows=_this$state.expandedRows;_this.setState({refreshing:true});_context.prev=2;_context.next=5;return _reporting.httpClient.get("/api/ezreporting/tasks/".concat(taskId,"/history"));case 5:resp=_context.sent;historyItems=resp;_context.next=12;break;case 9:_context.prev=9;_context.t0=_context["catch"](2);_reporting.toasts.addDanger({title:"Error",text:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.historyError",defaultMessage:"An error occurred while loading the history."})});case 12:historyItems=historyItems||[];Object.keys(expandedRows).forEach((function(historyId){var historyItem=historyItems.find((function(item){return item.id===historyId}));if(historyItem){_this.showDetails(historyItem)}else{_this.hideDetails(historyId)}}));_this.setState({refreshing:false,historyItems:historyItems});case 15:case"end":return _context.stop()}}}),_callee,null,[[2,9]])}))));_defineProperty(_assertThisInitialized(_this),"open",function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(taskId){return regeneratorRuntime.wrap((function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(!taskId||!_reporting.capabilities.show)){_context2.next=2;break}return _context2.abrupt("return");case 2:_this.setState({taskId:taskId,historyItems:[],isFlyoutVisible:true},_this.refresh);case 3:case"end":return _context2.stop()}}}),_callee2)})));return function(_x){return _ref2.apply(this,arguments)}}());_defineProperty(_assertThisInitialized(_this),"close",(function(){_this.setState({isFlyoutVisible:false})}));_defineProperty(_assertThisInitialized(_this),"onTableChange",(function(_ref3){var _ref3$page=_ref3.page,page=_ref3$page===void 0?{}:_ref3$page;var pageIndex=page.index,pageSize=page.size;_this.setState({pageIndex:pageIndex,pageSize:pageSize})}));_this.state={taskId:null,refreshing:false,isFlyoutVisible:false,historyItems:[],pageIndex:0,pageSize:10,expandedRows:{}};openFlyOutHandler=_this.open;closeFlyOutHandler=_this.close;return _this}_createClass(EzreportingHistoryFlyout,[{key:"render",value:function render(){var _this2=this;var _this$state2=this.state,refreshing=_this$state2.refreshing,isFlyoutVisible=_this$state2.isFlyoutVisible,historyItems=_this$state2.historyItems,expandedRows=_this$state2.expandedRows,pageIndex=_this$state2.pageIndex,pageSize=_this$state2.pageSize;if(!isFlyoutVisible){return _react.default.createElement(_react.Fragment,null)}var columns=[{field:"startTime",name:_i18n.i18n.translate("ezReporting.date",{defaultMessage:"Date"}),sortable:true,dataType:"date",align:"left"},{field:"status",name:_i18n.i18n.translate("ezReporting.status",{defaultMessage:"Status"}),sortable:true,align:"left",width:"140px",render:function render(status){switch(status){case"error":return _react.default.createElement(_eui.EuiHealth,{color:"danger"},_i18n.i18n.translate("ezReporting.error",{defaultMessage:"Error"}));case"completed":return _react.default.createElement(_eui.EuiHealth,{color:"success"},_i18n.i18n.translate("ezReporting.completed",{defaultMessage:"Completed"}));case"pending":return _react.default.createElement(_eui.EuiHealth,{color:"primary"},_i18n.i18n.translate("ezReporting.pending",{defaultMessage:"Pending"}));case"ongoing":return _react.default.createElement(_eui.EuiHealth,{color:"primary"},_i18n.i18n.translate("ezReporting.ongoing",{defaultMessage:"Ongoing"}));default:return _react.default.createElement(_eui.EuiHealth,{color:"subdued"},_i18n.i18n.translate("ezReporting.unknown",{defaultMessage:"Unknown"}))}}},{field:"executionTime",name:_i18n.i18n.translate("ezReporting.executionTime",{defaultMessage:"Execution time"}),sortable:true,align:"right",width:"140px",render:function render(executionTime){return(0,_reporting.ms2Str)(executionTime)}},{align:"right",width:"40px",isExpander:true,render:function render(item){return _react.default.createElement(_eui.EuiButtonIcon,{onClick:function onClick(){return _this2.toggleDetails(item)},"aria-label":expandedRows[item.id]?"Collapse":"Expand",iconType:expandedRows[item.id]?"arrowUp":"arrowDown"})}}];var pagination={pageIndex:pageIndex,pageSize:pageSize,totalItemCount:historyItems.length,pageSizeOptions:[10,20,30],hidePerPageOptions:false};var startIndex=pageIndex*pageSize;var endIndex=Math.min(startIndex+pageSize,historyItems.length);return(_react.default.createElement(_eui.EuiFlyout,{onClose:this.close,size:"m","aria-labelledby":"flyoutSmallTitle"},_react.default.createElement(_eui.EuiFlyoutHeader,{hasBorder:true},_react.default.createElement(_eui.EuiTitle,{size:"m"},_react.default.createElement("h2",null,_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.history",defaultMessage:"History"})))),_react.default.createElement(_eui.EuiFlyoutBody,null,_react.default.createElement(_eui.EuiBasicTable,{items:historyItems.slice(startIndex,endIndex),itemId:"id",itemIdToExpandedRowMap:this.state.expandedRows,isExpandable:true,columns:columns,pagination:pagination,onChange:this.onTableChange})),_react.default.createElement(_eui.EuiFlyoutFooter,null,_react.default.createElement(_eui.EuiFlexGroup,{justifyContent:"flexEnd"},_react.default.createElement(_eui.EuiFlexItem,{grow:false},_react.default.createElement(_eui.EuiButton,{iconType:"refresh",onClick:this.refresh,isLoading:refreshing,fill:true},_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.refresh",defaultMessage:"Refresh"})))))))}}]);return EzreportingHistoryFlyout}(_react.Component);exports.EzreportingHistoryFlyout=EzreportingHistoryFlyout},25:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EzreportingApp=void 0;var _react=_interopRequireWildcard(__webpack_require__(14));var _react2=__webpack_require__(15);var _reactRouterDom=__webpack_require__(20);var _eui=__webpack_require__(16);var _common=__webpack_require__(2);var _table=__webpack_require__(26);var _edit=__webpack_require__(23);var _history=__webpack_require__(24);var _reporting=__webpack_require__(22);function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap;_getRequireWildcardCache=function _getRequireWildcardCache(){return cache};return cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj}}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj.default=obj;if(cache){cache.set(obj,newObj)}return newObj}function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _createSuper(Derived){return function(){var Super=_getPrototypeOf(Derived),result;if(_isNativeReflectConstruct()){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var EzreportingApp=function(_Component){_inherits(EzreportingApp,_Component);var _super=_createSuper(EzreportingApp);function EzreportingApp(props){var _this;_classCallCheck(this,EzreportingApp);_this=_super.call(this,props);_defineProperty(_assertThisInitialized(_this),"componentDidMount",(function(){_reporting.httpClient.get("/api/ezreporting/tasks").then((function(res){_this.setState({tasks:res.tasks,dashboards:res.dashboards,frequencies:res.frequencies,reportingName:res.reportingName})})).catch((function(err){if(err.code===403){_this.setState({accessDenied:true})}return _reporting.toasts.addDanger({title:"Error",text:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.errorOccured",defaultMessage:"An error occurred while loading the data."})})}))}));_defineProperty(_assertThisInitialized(_this),"editTaskHandler",(function(task){if(_reporting.capabilities.edit){var body=JSON.stringify({dashboardId:task.dashboardId,frequency:task.reporting.frequency,emails:task.reporting.emails,print:task.reporting.print});return _reporting.httpClient.patch("/api/ezreporting/tasks/".concat(task._id),{body:body}).then((function(){var index=_this.state.tasks.findIndex((function(_ref){var _id=_ref._id;return _id===task._id}));var tasks=_this.state.tasks;tasks[index]=task;_this.setState({tasks:tasks});_reporting.toasts.addSuccess({title:"Success",text:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.editingSuccess",defaultMessage:"Task edited successfully."})});(0,_edit.closeFlyOut)();_this.forceUpdate()}))}}));_defineProperty(_assertThisInitialized(_this),"saveTaskHandler",(function(task){if(_reporting.capabilities.save){var tasks=_this.state.tasks;var body=JSON.stringify({dashboardId:task.dashboardId,frequency:task.reporting.frequency,emails:task.reporting.emails,print:task.reporting.print});return _reporting.httpClient.post("/api/ezreporting/tasks",{body:body}).then((function(res){task._id=res._id;task.reporting.createdAt=res.createdAt;tasks.push(task);_this.setState({tasks:tasks});_reporting.toasts.addSuccess({title:"Success",text:_react.default.createElement(_react2.FormattedMessage,{id:"ezreporting.editingSuccess",defaultMessage:"Task edited successfully."})});(0,_edit.closeFlyOut)();_this.forceUpdate()}))}}));_defineProperty(_assertThisInitialized(_this),"removeTaskHandler",(function(task){if(_reporting.capabilities.delete){if(task){_reporting.httpClient.delete("/api/ezreporting/tasks/".concat(task._id)).then((function(){var tasks=_this.state.tasks.filter((function(_ref2){var _id=_ref2._id;return _id!==task._id}));_this.setState({tasks:tasks});_reporting.toasts.addSuccess({title:"Success",text:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.removalSuccess",defaultMessage:"Task removed successfully."})});_this.forceUpdate()})).catch((function(){_reporting.toasts.addDanger({title:"Error",text:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.removalError",defaultMessage:"An error occurred during the removal of the task."})})}))}if(!task._id){_reporting.toasts.addDanger({title:"Error",text:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.removalError",defaultMessage:"An error occurred during the removal of the task."})})}}}));_defineProperty(_assertThisInitialized(_this),"downloadReport",(function(taskId){if(_reporting.capabilities.save&&taskId){return _reporting.httpClient.get("/api/ezreporting/tasks/".concat(taskId,"/download"))}}));_this.state={tasks:[],dashboards:[],frequencies:[],reportingName:"Reporting",accessDenied:false};return _this}_createClass(EzreportingApp,[{key:"render",value:function render(){var _this$props=this.props,basename=_this$props.basename,navigation=_this$props.navigation;var _this$state=this.state,tasks=_this$state.tasks,dashboards=_this$state.dashboards,frequencies=_this$state.frequencies,reportingName=_this$state.reportingName,accessDenied=_this$state.accessDenied;if(accessDenied){var defaultMsg="\n        You are not authorized to access Reporting.\n        To use Reporting management, you need the privileges granted by the `reporting` role.\n      ";return(_react.default.createElement(_eui.EuiEmptyPrompt,{iconType:"reportingApp",title:_react.default.createElement("h2",null,_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.accessDeniedTitle",defaultMessage:"Access denied"})),body:_react.default.createElement(_react.Fragment,null,_react.default.createElement("p",null,_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.accessDenied",defaultMessage:defaultMsg}),","))}))}return(_react.default.createElement(_reactRouterDom.BrowserRouter,{basename:basename},_react.default.createElement(_edit.EzreportingTaskEditFlyout,{dashboards:dashboards,frequencies:frequencies,editTaskHandler:this.editTaskHandler,saveTaskHandler:this.saveTaskHandler}),_react.default.createElement(_history.EzreportingHistoryFlyout,null),_react.default.createElement(_react2.I18nProvider,null,_react.default.createElement(_react.default.Fragment,null,_react.default.createElement(navigation.ui.TopNavMenu,{appName:_common.PLUGIN_ID,showSearchBar:false}),_react.default.createElement(_eui.EuiPage,{restrictWidth:"1000px"},_react.default.createElement(_eui.EuiPageBody,null,_react.default.createElement(_eui.EuiPageContent,null,_react.default.createElement(_eui.EuiPageContentHeader,null,_react.default.createElement(_eui.EuiPageContentHeaderSection,null,_react.default.createElement(_eui.EuiTitle,null,_react.default.createElement("h2",null,_react.default.createElement(_react2.FormattedMessage,{id:"ezreporting.title",defaultMessage:"{name}",values:{name:"".concat(_common.PLUGIN_NAME," ").concat(_common.PLUGIN_APP_NAME)}})))),_react.default.createElement(_eui.EuiPageContentHeaderSection,null,_react.default.createElement(_eui.EuiButton,{fill:true,iconType:"plusInCircle",isDisabled:dashboards.length>0?false:true,onClick:function onClick(){return dashboards.length>0?(0,_edit.openFlyOut)(null,false):null}},_react.default.createElement(_react2.FormattedMessage,{id:"ezreporting.createNewTask",defaultMessage:"New reporting task"})))),_react.default.createElement(_eui.EuiPageContentBody,null,_react.default.createElement(_table.EzreportingTable,{tasks:tasks,dashboards:dashboards,frequencies:frequencies,removeTaskHandler:this.removeTaskHandler,downloadReport:this.downloadReport})))))))))}}]);return EzreportingApp}(_react.Component);exports.EzreportingApp=EzreportingApp},26:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EzreportingTable=void 0;var _react=_interopRequireWildcard(__webpack_require__(14));var _i18n=__webpack_require__(17);var _react2=__webpack_require__(15);var _eui=__webpack_require__(16);var _moment=_interopRequireDefault(__webpack_require__(21));var _edit=__webpack_require__(23);var _history=__webpack_require__(24);var _reporting=__webpack_require__(22);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap;_getRequireWildcardCache=function _getRequireWildcardCache(){return cache};return cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj}}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj.default=obj;if(cache){cache.set(obj,newObj)}return newObj}function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _createSuper(Derived){return function(){var Super=_getPrototypeOf(Derived),result;if(_isNativeReflectConstruct()){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var EzreportingTable=function(_Component){_inherits(EzreportingTable,_Component);var _super=_createSuper(EzreportingTable);function EzreportingTable(props){var _this;_classCallCheck(this,EzreportingTable);_this=_super.call(this,props);_defineProperty(_assertThisInitialized(_this),"toggleDetails",(function(item){var itemIdToExpandedRowMap=_objectSpread({},_this.state.itemIdToExpandedRowMap);if(itemIdToExpandedRowMap[item._id]){delete itemIdToExpandedRowMap[item._id];return _this.setState({itemIdToExpandedRowMap:itemIdToExpandedRowMap})}var reporting=item.reporting;var receivers=Array.isArray(reporting.emails)?reporting.emails.join(", "):reporting.emails;var listItems=[{title:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.receiversEmails",defaultMessage:"Receivers' email addresses"}),description:receivers},{title:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.nextReport",defaultMessage:"Next report"}),description:reporting.runAt?(0,_moment.default)(reporting.runAt).format("YYYY-MM-DD hh:mm"):"N/A"},{title:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.createdAt",defaultMessage:"Creation date"}),description:reporting.createdAt?(0,_moment.default)(reporting.createdAt).format("YYYY-MM-DD"):"N/A"}];itemIdToExpandedRowMap[item._id]=_react.default.createElement(_eui.EuiDescriptionList,{listItems:listItems});return _this.setState({itemIdToExpandedRowMap:itemIdToExpandedRowMap})}));_defineProperty(_assertThisInitialized(_this),"onTableChange",(function(_ref){var _ref$page=_ref.page,page=_ref$page===void 0?{}:_ref$page;var pageIndex=page.index,pageSize=page.size;_this.setState({pageIndex:pageIndex,pageSize:pageSize})}));_this.state={itemIdToExpandedRowMap:{},pageIndex:0,pageSize:10};return _this}_createClass(EzreportingTable,[{key:"render",value:function render(){var _this2=this;var _this$state=this.state,pageIndex=_this$state.pageIndex,pageSize=_this$state.pageSize,itemIdToExpandedRowMap=_this$state.itemIdToExpandedRowMap;var _this$props=this.props,tasks=_this$props.tasks,dashboards=_this$props.dashboards,frequencies=_this$props.frequencies;var actions=[];if(_reporting.capabilities.edit){actions.push({name:_i18n.i18n.translate("ezReporting.edit",{defaultMessage:"Edit"}),description:_i18n.i18n.translate("ezReporting.edit",{defaultMessage:"Edit"}),icon:"pencil",type:"icon",color:"primary",onClick:function onClick(el){if(el.exists){return(0,_edit.openFlyOut)(el,true)}return _reporting.toasts.addDanger({title:"Error",text:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.dashboardNotFound",values:{DASHBOARD_ID:el.dashboardId},defaultMessage:"Dashboard nof found or remove (id: {DASHBOARD_ID})"})})}})}if(_reporting.capabilities.save){actions.push({name:_i18n.i18n.translate("ezReporting.generate",{defaultMessage:"Generate"}),description:_i18n.i18n.translate("ezReporting.generate",{defaultMessage:"Generate"}),icon:"importAction",type:"icon",color:"primary",onClick:function onClick(el){if(el.exists){return _this2.props.downloadReport(el._id).then((function(){return _reporting.toasts.addInfo({title:"Information",text:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.generated",defaultMessage:"Your report will be sent to you by email"})})})).catch((function(){return _reporting.toasts.addDanger({title:"Error",text:_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.generationError",defaultMessage:"An error occurred while downloading report."})})}))}}})}if(_reporting.capabilities.show){actions.push({name:_i18n.i18n.translate("ezReporting.history",{defaultMessage:"History"}),description:_i18n.i18n.translate("ezReporting.history",{defaultMessage:"History"}),icon:"clock",type:"icon",color:"primary",onClick:function onClick(el){if(el.exists){(0,_history.openFlyOut)(el._id,false)}}})}if(_reporting.capabilities.delete){actions.push({name:_i18n.i18n.translate("ezReporting.delete",{defaultMessage:"Delete"}),description:_i18n.i18n.translate("ezReporting.delete",{defaultMessage:"Delete"}),icon:"trash",type:"icon",color:"danger",onClick:function onClick(el){_this2.props.removeTaskHandler(el)}})}var columns=[{name:_i18n.i18n.translate("ezReporting.dashboard",{defaultMessage:"Dashboard"}),description:_i18n.i18n.translate("ezReporting.dashboardName",{defaultMessage:"Dashboard name"}),align:"left",render:function render(_ref2){var dashboardId=_ref2.dashboardId,reporting=_ref2.reporting;if(dashboardId){var dashboard=dashboards.find((function(_ref3){var id=_ref3.id;return id===dashboardId}));if(dashboard){if(reporting.print){var content=_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.optimizedForPrinting",defaultMessage:"Optimized for printing"});return(_react.default.createElement("span",null,_react.default.createElement(_eui.EuiLink,{href:"kibana#/dashboard/".concat(dashboardId)},dashboard.name)," "," ",_react.default.createElement(_eui.EuiToolTip,{position:"right",content:content},_react.default.createElement(_eui.EuiText,null,""))))}return(_react.default.createElement(_eui.EuiLink,{href:"kibana#/dashboard/".concat(dashboardId)},dashboard.name))}}return(_react.default.createElement(_eui.EuiTextColor,{color:"warning"},_react.default.createElement(_eui.EuiIcon,{type:"alert"}),_react.default.createElement(_react2.FormattedMessage,{id:"ezReporting.dashboardNotFound",values:{DASHBOARD_ID:dashboardId},defaultMessage:"Dashboard nof found or remove (id: {DASHBOARD_ID})"})))}},{name:_i18n.i18n.translate("ezReporting.frequency",{defaultMessage:"Frequency"}),description:_i18n.i18n.translate("ezReporting.frequency",{defaultMessage:"Frequency"}),render:function render(_ref4){var reporting=_ref4.reporting;return(0,_reporting.convertFrequency)(frequencies,reporting.frequency)},align:"center"},{name:_i18n.i18n.translate("ezReporting.sentAt",{defaultMessage:"Last sent"}),description:_i18n.i18n.translate("ezReporting.sentAt",{defaultMessage:"Last sent"}),align:"center",render:function render(_ref5){var reporting=_ref5.reporting;if(reporting.sentAt&&reporting.sentAt!=="1970-01-01T12:00:00.000Z"){return(0,_moment.default)(reporting.sentAt).format("YYYY-MM-DD")}return"-"}},{actions:actions,align:"right",width:"32px"},{align:"right",width:"40px",isExpander:true,render:function render(item){return _react.default.createElement(_eui.EuiButtonIcon,{onClick:function onClick(){return _this2.toggleDetails(item)},"aria-label":itemIdToExpandedRowMap[item._id]?"Collapse":"Expand",iconType:itemIdToExpandedRowMap[item._id]?"arrowUp":"arrowDown"})}}];var pagination={pageIndex:pageIndex,pageSize:pageSize,totalItemCount:tasks.length,pageSizeOptions:[10,20,30],hidePerPageOptions:false};var startIndex=pageIndex*pageSize;var endIndex=Math.min(startIndex+pageSize,tasks.length);return(_react.default.createElement(_eui.EuiBasicTable,{items:tasks.slice(startIndex,endIndex),itemId:"_id",itemIdToExpandedRowMap:itemIdToExpandedRowMap,isExpandable:true,hasActions:true,columns:columns,pagination:pagination,onChange:this.onTableChange}))}}]);return EzreportingTable}(_react.Component);exports.EzreportingTable=EzreportingTable}}]);