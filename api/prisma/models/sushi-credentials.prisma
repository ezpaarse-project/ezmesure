/// A set of SUSHI credentials, associated to a SUSHI endpoint
model SushiCredentials {
  /// ID of the SUSHI credentials
  id                String                        @id @default(cuid())
  /// Creation date
  createdAt         DateTime                      @default(now())
  /// Latest update date
  updatedAt         DateTime                      @updatedAt
  /// When item was marked for deletion
  deletedAt         DateTime?
  /// ID of the institution that owns the credentials
  institutionId     String
  /// ID of the SUSHI endpoint
  endpointId        String
  /// ID of the deletion task
  deletionTaskId    String?
  /// Value of the customer_id parameter
  customerId        String?
  /// Value of the requestor_id parameter
  requestorId       String?
  /// Value of the api_key parameter
  apiKey            String?
  /// Abritrary comment about the credentials
  comment           String?
  /// Whether the credentials are active and can be harvested
  active            Boolean                       @default(true)
  /// Date on which the active status was last modified
  activeUpdatedAt   DateTime                      @default(now())
  /// Whether the credentials are archived
  archived          Boolean                       @default(false)
  /// Date on which the archived status was last modified
  archivedUpdatedAt DateTime                      @default(now())
  /// Packages (profiles, accounts, funds...) that include the credentials
  packages          String[]
  /// Abritrary tag list associated to the credentials
  tags              String[]
  /// Additionnal parameters. Each param has a name, a value, and a scope.
  params            Json[]
  /// Institution that owns the credentials
  institution       Institution                   @relation(fields: [institutionId], references: [id], onDelete: Cascade)
  /// The SUSHI endpoint
  endpoint          SushiEndpoint                 @relation(fields: [endpointId], references: [id], onDelete: Cascade)
  /// The harvest jobs associated to the credentials
  harvestJobs       HarvestJob[]
  /// The harvest states associated to the credentials
  harvests          Harvest[]
  /// The deletion task associated to the credentials
  deletionTask      SushiCredentialsDeletionTask? @relation(fields: [deletionTaskId], references: [id], onDelete: Cascade)
  /// Last connection test. Format: { date: DateTime, status: String, exceptions: Json[], errorCode: String? }
  connection        Json?
}

model SushiCredentialsDeletionTask {
  /// ID of the Elastic task
  id           String             @id
  /// Progress of the task
  progress     Int                @default(0)
  /// Index pattern related to the task
  indexPattern String
  /// Is the task canceled
  canceled     Boolean            @default(false)
  /// Error encountered with the task
  error        String?
  /// Creation date
  createdAt    DateTime           @default(now())
  /// Latest update date
  updatedAt    DateTime           @updatedAt
  /// Credentials related to task
  credentials  SushiCredentials[]
}
