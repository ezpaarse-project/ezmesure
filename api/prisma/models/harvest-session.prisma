/// Possible statuses of an harvest session
enum HarvestSessionStatus {
  /// The session is prepared, ready to be started
  prepared
  /// The session is starting, preparing things before launching jobs
  starting
  /// The session is running, it launched jobs and wait for them to finish
  running
  /// The session terminated
  finished
  /// The session is stopping
  stopping
  /// The session was forcefully stopped
  stopped
}

/// Represent a harvest session
model HarvestSession {
  /// ID of the session
  id                     String               @id @default(cuid())
  /// Beginning of the requested period
  beginDate              String
  /// End of the requested period
  endDate                String
  /// Query to get sushi credentials
  credentialsQuery       Json
  /// Jobs created after request
  jobs                   HarvestJob[]
  /// IDs of the requested reports (ex: tr_j1)
  reportTypes            String[]
  /// Allowed COUNTER versions (ex: ['5.1', '5'])
  allowedCounterVersions String[]
  /// Maximum execution time of a job
  timeout                Int                  @default(600)
  /// Whether the reports should be fetched even if credentials aren't verified or wrong
  allowFaulty            Boolean              @default(false)
  /// Whether the reports should be downloaded even if not supported by the endpoint
  downloadUnsupported    Boolean              @default(false)
  /// Whether the reports should be downloaded even if a local copy already exists
  forceDownload          Boolean              @default(false)
  /// Whether a mail should be sent when session ended
  sendEndMail            Boolean              @default(true)
  /// Whether the reports should be inserted even if it does not pass the validation step
  ignoreValidation       Boolean?
  /// Parameters to pass to jobs
  params                 Json?                @default("{}")
  /// Status of session
  status                 HarvestSessionStatus @default(prepared)
  /// Start date
  startedAt              DateTime?
  /// Deletion date
  deletedAt              DateTime?
  /// Creation date (the first time is got prepared)
  createdAt              DateTime             @default(now())
  /// Latest update date
  updatedAt              DateTime             @updatedAt
}
